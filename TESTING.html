<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Company Reports & Filings Finder</title>
    <style>
        body {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }

        .search-container {
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
        }

        input, button {
            padding: 10px;
            font-size: 16px;
        }

        input {
            flex: 1;
            max-width: 200px;
        }

        .category-section {
            margin-bottom: 30px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }

        .category-title {
            font-size: 1.2em;
            color: #2c5282;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #edf2f7;
        }

        .document-item {
            padding: 10px;
            margin-bottom: 10px;
            background: #f8fafc;
            border-radius: 4px;
        }

        .document-title {
            color: #2b6cb0;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .document-date {
            color: #718096;
            font-size: 0.9em;
        }

        .loading {
            color: #666;
            font-style: italic;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="search-container">
        <input type="text" id="stockInput" placeholder="Enter company symbol (e.g. AAPL)" 
               onkeypress="if(event.key === 'Enter') searchCompanyDocs()">
        <button onclick="searchCompanyDocs()">Find Company Documents</button>
    </div>

    <div id="results"></div>

    <script>
async function searchCompanyDocs() {
    const stock = document.getElementById('stockInput').value.trim().toUpperCase();
    const resultsDiv = document.getElementById('results');
    
    if (!stock) {
        resultsDiv.innerHTML = '<div class="error">Please enter a company symbol</div>';
        return;
    }

    resultsDiv.innerHTML = `<div class="loading">Searching for ${stock}'s official documents and filings...</div>`;

    try {
        // First, let's get an overview of the company
        const companyOverview = await searchCategory(stock, 'company overview business description');
        
        // Then get our document categories
        const [annualResults, secResults, newsResults, governanceResults] = await Promise.all([
            searchCategory(stock, 'annual report financial statements'),
            searchCategory(stock, 'SEC filings 10-K 10-Q 8-K'),
            searchCategory(stock, 'press releases news announcements'),
            searchCategory(stock, 'corporate governance leadership board directors')
        ]);

        const categories = {
            'Annual & Interim Reports': annualResults,
            'SEC Filings': secResults,
            'News Releases': newsResults,
            'Corporate Governance': governanceResults
        };

        let html = '';
        
        // Add company overview at the top
        if (companyOverview && companyOverview.length > 0) {
            html += `
                <div class="category-section">
                    <div class="category-title">${stock} Company Overview</div>
                    <div class="overview-content">${companyOverview[0].content}</div>
                </div>`;
        }

        // Generate HTML for each category
        for (const [category, results] of Object.entries(categories)) {
            html += generateCategoryHTML(category, results);
        }

        // Generate and add summary section
        html += generateSummarySection(stock, categories, companyOverview);

        resultsDiv.innerHTML = html;

    } catch (error) {
        resultsDiv.innerHTML = `<div class="error">Error fetching documents: ${error.message}</div>`;
    }
}

function generateSummarySection(stock, categories, overview) {
    // Add style for summary section
    const style = document.createElement('style');
    style.textContent = `
        .summary-section {
            margin-top: 40px;
            padding: 25px;
            background: #f8fafc;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }
        .summary-title {
            font-size: 1.5em;
            color: #2d3748;
            margin-bottom: 20px;
            border-bottom: 2px solid #cbd5e0;
            padding-bottom: 10px;
        }
        .summary-content {
            line-height: 1.8;
        }
        .category-summary {
            margin: 15px 0;
        }
        .category-summary-title {
            font-weight: 600;
            color: #4a5568;
        }
    `;
    document.head.appendChild(style);

    // Create summary content
    let summaryHtml = `
        <div class="summary-section">
            <div class="summary-title">Document Analysis Summary for ${stock}</div>
            <div class="summary-content">`;

    // Add overview summary
    if (overview && overview.length > 0) {
        summaryHtml += `
            <div class="category-summary">
                <div class="category-summary-title">Company Overview:</div>
                <p>${overview[0].content.substring(0, 300)}...</p>
            </div>`;
    }

    // Summarize each category
    for (const [category, results] of Object.entries(categories)) {
        if (results && results.length > 0) {
            const latestDate = findLatestDate(results);
            summaryHtml += `
                <div class="category-summary">
                    <div class="category-summary-title">${category}:</div>
                    <p>Found ${results.length} documents${latestDate ? `, most recent from ${latestDate}` : ''}. 
                    Key highlights include: ${extractKeyHighlights(results)}</p>
                </div>`;
        }
    }

    summaryHtml += `</div></div>`;
    return summaryHtml;
}

function findLatestDate(results) {
    let latestDate = null;
    for (const result of results) {
        const dateMatch = result.content.match(/\b\d{1,2}[/-]\d{1,2}[/-]\d{2,4}\b/) || 
                         result.title.match(/\b\d{1,2}[/-]\d{1,2}[/-]\d{2,4}\b/);
        if (dateMatch) {
            const date = new Date(dateMatch[0]);
            if (!latestDate || date > latestDate) {
                latestDate = date;
            }
        }
    }
    return latestDate ? latestDate.toLocaleDateString() : null;
}

function extractKeyHighlights(results) {
    // Extract important keywords and phrases from the results
    const highlights = [];
    const keywords = ['financial', 'report', 'announcement', 'filing', 'earnings', 'quarter', 'annual'];
    
    for (const result of results) {
        for (const keyword of keywords) {
            if (result.title.toLowerCase().includes(keyword)) {
                highlights.push(result.title.split(' ').slice(0, 5).join(' ') + '...');
                break;
            }
        }
        if (highlights.length >= 2) break;
    }
    
    return highlights.join('; ');
}
    </script>
</body>
</html>