<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Company Reports & Filings Finder</title>
    <style>
        body {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }

        .search-container {
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
        }

        input, button {
            padding: 10px;
            font-size: 16px;
        }

        input {
            flex: 1;
            max-width: 200px;
        }

        .category-section {
            margin-bottom: 30px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }

        .category-title {
            font-size: 1.2em;
            color: #2c5282;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #edf2f7;
        }

        .document-item {
            padding: 10px;
            margin-bottom: 10px;
            background: #f8fafc;
            border-radius: 4px;
        }

        .document-title {
            color: #2b6cb0;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .document-date {
            color: #718096;
            font-size: 0.9em;
        }

        .loading {
            color: #666;
            font-style: italic;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="search-container">
        <input type="text" id="stockInput" placeholder="Enter company symbol (e.g. AAPL)" 
               onkeypress="if(event.key === 'Enter') searchCompanyDocs()">
        <button onclick="searchCompanyDocs()">Find Company Documents</button>
    </div>

    <div id="results"></div>

    <script>
        async function searchCompanyDocs() {
            const stock = document.getElementById('stockInput').value.trim().toUpperCase();
            const resultsDiv = document.getElementById('results');
            
            if (!stock) {
                resultsDiv.innerHTML = '<div class="error">Please enter a company symbol</div>';
                return;
            }

            resultsDiv.innerHTML = `<div class="loading">Searching for ${stock}'s official documents and filings...</div>`;

            // We'll make multiple focused searches to get different types of documents
            try {
                const [annualResults, secResults, newsResults, governanceResults] = await Promise.all([
                    searchCategory(stock, 'annual report financial statements'),
                    searchCategory(stock, 'SEC filings 10-K 10-Q 8-K'),
                    searchCategory(stock, 'press releases news announcements'),
                    searchCategory(stock, 'corporate governance leadership board directors')
                ]);

                // Organize results by category
                const categories = {
                    'Annual & Interim Reports': annualResults,
                    'SEC Filings': secResults,
                    'News Releases': newsResults,
                    'Corporate Governance': governanceResults
                };

                let html = '';
                
                // Generate HTML for each category
                for (const [category, results] of Object.entries(categories)) {
                    html += generateCategoryHTML(category, results);
                }

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error fetching documents: ${error.message}</div>`;
            }
        }

        async function searchCategory(stock, category) {
            const response = await fetch('https://api.tavily.com/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    api_key: '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',
                    query: `${stock} ${category} site:*.${stock.toLowerCase()}.com OR site:investors.${stock.toLowerCase()}.com`,
                    search_depth: 'advanced',
                    max_results: 5,
                    include_domains: [
                        `${stock.toLowerCase()}.com`,
                        `investors.${stock.toLowerCase()}.com`,
                        'sec.gov',
                        'edgar-online.com'
                    ]
                })
            });

            const data = await response.json();
            return data.results;
        }

        function generateCategoryHTML(category, results) {
            if (!results || results.length === 0) {
                return '';
            }

            let html = `
                <div class="category-section">
                    <div class="category-title">${category}</div>`;

            results.forEach(result => {
                // Try to extract date from the content or title
                const dateMatch = result.content.match(/\b\d{1,2}[/-]\d{1,2}[/-]\d{2,4}\b/) || 
                                result.title.match(/\b\d{1,2}[/-]\d{1,2}[/-]\d{2,4}\b/);
                const dateStr = dateMatch ? `(${dateMatch[0]})` : '';

                html += `
                    <div class="document-item">
                        <div class="document-title">
                            <a href="${result.url}" target="_blank">${result.title}</a>
                            <span class="document-date">${dateStr}</span>
                        </div>
                        <div class="document-content">${result.content.substring(0, 200)}...</div>
                    </div>`;
            });

            html += '</div>';
            return html;
        }

        // Auto-search if stock symbol is in URL
        const urlParams = new URLSearchParams(window.location.search);
        const stockParam = urlParams.get('stock');
        if (stockParam) {
            document.getElementById('stockInput').value = stockParam;
            searchCompanyDocs();
        }
    </script>
</body>
</html>