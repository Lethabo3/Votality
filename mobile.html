
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Bimo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="favicon5.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="manifest" href="/manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('/service-worker.js')
            .then(function(registration) {
              console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }, function(error) {
              console.log('ServiceWorker registration failed: ', error);
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
/* Core Animation Definitions
   These animations handle smooth transitions for elements appearing and disappearing */
   @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

@keyframes slideIn {
    from { 
        opacity: 0; 
        transform: translateY(20px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

/* Animation Classes
   These classes can be applied to elements to trigger the animations */
.fade-in {
    animation: fadeIn 0.5s ease-out;
}

.fade-out {
    animation: fadeOut 0.5s ease-out forwards;
}

.slide-in {
    animation: slideIn 0.3s ease-out;
}

/* Chat Container Layout
   Main container for the chat interface with appropriate spacing */
.chat-container {
    height: calc(100vh - 240px);
    overflow-y: auto;
    padding-top: 20px;
    padding-bottom: 20px;
    mask-image: linear-gradient(to top, black 80%, transparent 100%);
    -webkit-mask-image: linear-gradient(to top, black 80%, transparent 100%);
}

/* Message Styling
   Defines appearance of chat messages from both user and AI */
.message {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 20px;
    margin-bottom: 10px;
}

.user-message {
    background-color: #e6e6e6;
    align-self: flex-end;
}

.ai-message {
    background-color: #fff;
    align-self: flex-start;
}

/* Input Container Configuration
   Contains the chat input field and associated buttons */
.input-container {
    position: relative;
    top: -4.1vh;
}

/* User Input Field Styling */
#user-input {
    border-radius: 110px;
    background-color: #ffffff;
    width: 100%;
    color: #333;
}

#user-input::placeholder {
    color: #333;
    transition: all 0.3s ease;
    padding-left: 5px;
}

#user-input:focus::placeholder {
    opacity: 0;
}

/* Button Styling for Attachment and Submit */
#attachment-button,
#submit-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: transparent;
    border: none;
    cursor: pointer;
    z-index: 10;
}

#attachment-button {
    left: 10px;
}

/* File Input and Preview Styling */
#file-input {
    display: none;
}

.file-preview {
    display: flex;
    align-items: center;
    margin-top: 10px;
    padding: 5px;
    background-color: #f0f0f0;
    border-radius: 5px;
}

.file-preview img {
    max-width: 50px;
    max-height: 50px;
    margin-right: 10px;
}

.file-preview .file-name {
    flex-grow: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.file-preview .remove-file {
    cursor: pointer;
    color: #888;
    margin-left: 10px;
}

/* Submit Button Specific Styling */
#submit-button {
    right: 10px;
    border-radius: 904px;
    margin-top: -2px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

#submit-button.visible {
    opacity: 1;
}

#submit-button:hover div {
    transform: scale(1.1);
}

/* Utility Classes */
.custom-rounded {
    border-radius: 904px;
    background-color: rgba(255, 255, 255, 0.1);
}

/* Logo Container Positioning */
.logo-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    z-index: 5;
}

/* Bento Grid Layout */
.bento-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 30px;
    position: relative;
    z-index: 10;
}

.bento-box {
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 20px;
    padding: 0.75rem;
    transition: all 0.3s ease;
    flex: 1;
    min-width: calc(50% - 5px);
    font-size: 0.8rem;
    cursor: pointer;
}

.bento-box:hover {
    background-color: #e6e6e6;
    transform: translateY(-2px);
}

/* Navigation Menu Styling */
.nav-toggle {
    cursor: pointer;
    transition: transform 0.3s ease;
}

.nav-toggle:hover {
    transform: scale(1.1);
}

.nav-menu {
    position: fixed;
    top: 0;
    left: -300px;
    width: 300px;
    height: 100vh;
    background-color: #ffffff;
    border-right: 1px solid #d1d1d1;
    transition: left 0.3s ease;
    z-index: 1000;
    display: flex;
    flex-direction: column;
}

.nav-menu.open {
    left: 0;
}

/* Navigation Overlay and Hover Area */
.nav-hover-area {
    position: fixed;
    top: 0;
    left: 0;
    width: 50px;
    height: 100vh;
    z-index: 999;
}

.nav-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.5);
    display: none;
    z-index: 999;
}

.nav-overlay.open {
    display: block;
}

/* Navigation Content Layout */
.nav-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Recent Chat Styling */
.recent-chat {
    background-color: #f0f0f0;
    border-radius: 13px;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    word-break: break-all;
    display: flex;
    align-items: center;
    position: relative;
}

.recent-chats-container {
    flex-grow: 1;
    overflow-y: auto;
    padding: 1rem;
}

.recent-chat:hover {
    background-color: #e6e6e6;
}

/* Menu Icon Styling */
.menu-icon {
    position: absolute;
    right: 10px;
    display: none;
    cursor: pointer;
    color: #666;
}

.recent-chat:hover .menu-icon {
    display: inline-block;
}

#recent-chats {
    max-height: calc(100vh - 200px);
    overflow-y: auto;
}

/* User Email Container Styling */
.user-email-container {
    background-color: #e9e9e9;
    border-radius: 15px;
    padding: 0.5rem 0.75rem 0.5rem 0.5rem;
    font-size: 0.9rem;
    text-align: left;
    word-break: break-all;
    margin: 10px;
    position: absolute;
    bottom: 50px;
    left: 10px;
    right: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    display: flex;
    align-items: center;
}

.user-email-container:hover {
    background-color: #d9d9d9;
}

/* User Profile Circle */
.user-profile-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: #FFF;
    color: #4a5568;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-right: 0.75rem;
    flex-shrink: 0;
}

/* Email Display Styling */
.user-email {
    flex-grow: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Email Dropdown Menu */
.email-dropdown {
    position: absolute;
    bottom: 70px;
    left: 10px;
    right: 10px;
    background-color: #ffffff;
    border-radius: 15px;
    padding: 1rem;
    display: none;
    z-index: 1001;
}

.email-dropdown.show {
    display: block;
}

.email-dropdown-item {
    padding: 0.5rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
    border-radius: 10px;
}

.email-dropdown-item:hover {
    background-color: #f0f0f0;
}

.email-dropdown-divider {
    height: 1px;
    background-color: #e0e0e0;
    margin: 0.5rem 0;
}

/* Top Icons Layout */
.top-icons {
    position: fixed;
    top: 10px;
    left: 10px;
    right: 10px;
    display: flex;
    justify-content: space-between;
    z-index: 1000;
}

/* Icon Button Styling */
.icon-button {
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
}

.icon-button svg {
    width: 24px;
    height: 24px;
}

/* Navigation Header */
.nav-header h2 {
    font-size: 1.3rem;
    font-weight: 500;
    margin-left: 2vh;
    color: #333;
    margin-top: 5vh;
}

/* Root Variables */
:root {
    --container-radius: 14px;
}

/* Base Styles */
body {
    background-color: transparent;
    min-height: 100vh;
}

.container {
    background-color: transparent;
}

/* Footer Styling with Gradient */
footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding-top: 80px;
    background: linear-gradient(
        to bottom, 
        rgba(224, 224, 224, 0) 0%,
        rgba(224, 224, 224, 0.7) 40%,
        rgba(200, 200, 200, 0.9) 100%
    );
    backdrop-filter: blur(10px);
}

/* Wave Animation */
@keyframes waveAnimation {
    0%, 100% { d: path('M8 11c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S5 3.34 5 5v3c0 1.66 1.34 3 3 3z'); }
    25% { d: path('M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z'); }
    50% { d: path('M16 11c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3s-3 1.34-3 3v3c0 1.66 1.34 3 3 3z'); }
    75% { d: path('M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z'); }
}

#waves-container path {
    animation: waveAnimation 3s ease-in-out infinite;
}

#waves-container {
    transition: opacity 0.3s ease-in-out;
}

/* Wave Animation Elements */
#wave-animation {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 20px;
    width: 30px;
    right: 20px;
}

.wave-bar {
    width: 3px;
    height: 100%;
    background-color: #000;
    margin: 0 1px;
    border-radius: 3px;
    animation: wave 1.5s infinite ease-in-out;
}

/* Individual Wave Bar Animations */
.wave-bar:nth-child(1) { height: 30%; animation-delay: 0.2s; }
.wave-bar:nth-child(2) { height: 60%; animation-delay: 0.2s; }
.wave-bar:nth-child(3) { height: 100%; animation-delay: 0.1s; }
.wave-bar:nth-child(4) { height: 60%; animation-delay: 0.2s; }
.wave-bar:nth-child(5) { height: 30%; animation-delay: 0.4s; }

@keyframes wave {
    0%, 100% { transform: scaleY(1); }
    50% { transform: scaleY(0.2); }
}

/* Cancel Button */
#cancel-button {
    display: none;
}
    </style>

</head>

<body class="bg-white text-gray-800 font-sans">

    <div class="top-icons">

        <button id="nav-toggle" class="nav-toggle text-gray-600 hover:text-gray-800">

            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">

                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h12M4 18h8" />

            </svg>

        </button>

        <div id="name-dropdown" class="flex items-center cursor-pointer">

            <span class="mr-1">Votality</span>

            

        </div>

        

        <button id="new-chat-button" class="icon-button">

            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">

                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />

            </svg>

        </button>

    </div>



    <div id="nav-hover-area" class="nav-hover-area"></div>



    <nav id="nav-menu" class="nav-menu">

        <div class="nav-content">

            <button id="close-nav" class="close-nav">

                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">

                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h12M4 18h8" />

                </svg>

            </button>

            <div class="nav-header">

                <h2>Conversations</h2>

            </div>

            <div class="recent-chats-container" id="recent-chats">

                <!-- Recent chats will be dynamically added here -->

            </div>

        </div>

        <div id="userEmailContainer" class="user-email-container">

            <div id="userProfileCircle" class="user-profile-circle"></div>

            <div id="userEmail" class="user-email"></div>

        </div>

        <div id="emailDropdown" class="email-dropdown">

            <div id="dropdownEmail" class="email-dropdown-item font-bold"></div>

            <div class="email-dropdown-divider"></div>

            <div class="email-dropdown-item" onclick="openHelp()">Help & FAQ</div>

            <div class="email-dropdown-item" onclick="openSettings()">Settings</div>

            <div class="email-dropdown-item" onclick="openLearnMore()">Learn More</div>

            <div class="email-dropdown-divider"></div>

            <div class="email-dropdown-item text-red-600" onclick="logout()">Log out</div>

        </div>

    </nav>



    <div id="nav-overlay" class="nav-overlay"></div>



    <div class="container mx-auto px-4 min-h-screen flex flex-col relative pt-16">

        <div id="logo-container" class="logo-container fade-in">

            <img src="Votality.jpg" alt="Votality.jpg Campus Logo" class="w-32 h-32 object-cover mb-4">

        </div>



        <main class="flex-grow flex flex-col">

            <div id="chat-container" class="chat-container flex flex-col p-4" style="display: none;"></div>

        </main>



        <footer class="py-4 fixed bottom-0 left-0 right-0 bg-white">

            

            <form id="chat-form" class="flex flex-col items-center max-w-3xl mx-auto px-4 mt-4">

            <div id="file-preview" class="w-full mb-2" style="display: none;"></div>

            <div class="input-container w-full relative">

                <textarea id="user-input" placeholder="Message Votality AI" class="w-full p-3 pl-12 pr-12 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 custom-rounded resize-none overflow-hidden" rows="1" style="height: 50px;"></textarea>

                <input type="file" id="file-input" accept="image/*,.pdf,.doc,.docx,.txt">

                <button type="button" id="attachment-button" class="absolute left-2 top-1/2 transform -translate-y-1/2 focus:outline-none">

                    <div class="custom-rounded bg-transparent p-2 transition-colors duration-200">

                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="black" class="h-5 w-5">

                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />

                        </svg>                        

                    </div>

                </button>

                <div id="wave-animation" class="absolute right-2 top-1/2 transform -translate-y-1/2">

                    <div class="wave-bar"></div>

                    <div class="wave-bar"></div>

                    <div class="wave-bar"></div>

                    <div class="wave-bar"></div>

                    <div class="wave-bar"></div>

                </div>

                <button type="submit" id="submit-button" class="absolute right-2 top-1/2 transform -translate-y-1/2 focus:outline-none" style="display: none;">

                    <div class="custom-rounded bg-gray-200 p-2 hover:bg-gray-300 transition-colors duration-200">

                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-5 w-5 text-gray-600">

                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />

                        </svg>

                    </div>

                </button>

            </div>

        </form>

    </footer>

    </div>



    <script>

        // DOM Elements

        const userInput = document.getElementById('user-input');

        const submitButton = document.getElementById('submit-button');

        const logoContainer = document.getElementById('logo-container');

        const chatContainer = document.getElementById('chat-container');

        const bentoGrid = document.getElementById('bento-grid');

        const navToggle = document.getElementById('nav-toggle');

        const navMenu = document.getElementById('nav-menu');

        const navHoverArea = document.getElementById('nav-hover-area');

        const newChatButton = document.getElementById('new-chat-button');

        const navOverlay = document.getElementById('nav-overlay');

        const userEmailContainer = document.getElementById('userEmailContainer');

        const emailDropdown = document.getElementById('emailDropdown');



        let currentChatId = null;



        // Event Listeners

        userInput.addEventListener('input', function() {

            submitButton.classList.toggle('visible', this.value.trim() !== '');

        });



        navToggle.addEventListener('mouseenter', openNav);

        navHoverArea.addEventListener('mouseenter', openNav);

        navMenu.addEventListener('mouseleave', closeNav);

        navOverlay.addEventListener('click', closeNav);



        navToggle.addEventListener('mouseleave', (e) => {

            if (!navMenu.contains(e.relatedTarget) && e.relatedTarget !== navHoverArea) {

                closeNav();

            }

        });



        newChatButton.addEventListener('click', createNewChat);



        userEmailContainer.addEventListener('click', function(e) {

            e.stopPropagation();

            emailDropdown.classList.toggle('show');

        });



        document.addEventListener('click', function(e) {

            if (!emailDropdown.contains(e.target) && !userEmailContainer.contains(e.target)) {

                emailDropdown.classList.remove('show');

            }

        });



        // Functions

        function openNav() {

            navMenu.classList.add('open');

            navOverlay.style.display = 'block';

            updateUserEmailDisplay();

            loadRecentChats();

        }



        function closeNav() {

            navMenu.classList.remove('open');

            navOverlay.style.display = 'none';

        }



        async function sendMessage(message) {

    if (logoContainer.style.display !== 'none') {

        logoContainer.classList.add('fade-out');

        setTimeout(() => {

            logoContainer.style.display = 'none';

            chatContainer.style.display = 'flex';

            bentoGrid.style.display = 'none';

        }, 500);

    }

    addMessage(message, 'user');

    userInput.value = '';

    submitButton.classList.remove('visible');



    try {

        const response = await fetch('VotalityChat.php', {

            method: 'POST',

            headers: {

                'Content-Type': 'application/json',

            },

            body: JSON.stringify({

                action: 'sendMessage',

                message: message,

                chatId: currentChatId

            }),

        });

    

        if (!response.ok) {

            throw new Error(`HTTP error! status: ${response.status}`);

        }

    

        const data = await response.json();

    

        if (data.error) {

            throw new Error(data.error);

        }

    

        addMessage(data.response, 'ai');

        

        // Refresh recent chats to update summary if it was the first message

        loadRecentChats();

    } catch (error) {

        console.error('Error:', error);

        addMessage("I'm sorry, there was an error processing your request: " + error.message, 'ai');

    }

}



        function updateUserEmailDisplay() {

            fetch('get_user_email.php')

                .then(response => response.json())

                .then(data => {

                    const userEmailContainer = document.getElementById('userEmailContainer');

                    const userProfileCircle = document.getElementById('userProfileCircle');

                    const userEmail = document.getElementById('userEmail');

                    const dropdownEmail = document.getElementById('dropdownEmail');

                    

                    if (data.email && data.email !== 'Not logged in') {

                        userEmail.textContent = data.email;

                        dropdownEmail.textContent = data.email;

                        userEmailContainer.style.display = 'flex';

                        

                        // Get initials from the full name

                        const initials = data.fullname.split(' ').map(n => n[0]).join('').toUpperCase();

                        userProfileCircle.textContent = initials;

                    } else {

                        userEmailContainer.style.display = 'none';

                    }

                })

                .catch(error => {

                    console.error('Error fetching user email:', error);

                });

        }



        function sendBentoMessage(message) {

            sendMessage(message);

        }



        function addMessage(text, sender) {

            const messageDiv = document.createElement('div');

            messageDiv.classList.add('message', sender === 'user' ? 'user-message' : 'ai-message', 'slide-in');

            messageDiv.textContent = text;

            chatContainer.appendChild(messageDiv);

            chatContainer.scrollTop = chatContainer.scrollHeight;

        }



        async function createNewChat() {

            try {

                const response = await fetch('VotalityChat.php', {

                    method: 'POST',

                    headers: {

                        'Content-Type': 'application/json',

                    },

                    body: JSON.stringify({

                        action: 'createNewChat'

                    }),

                });



                if (!response.ok) {

                    throw new Error(`HTTP error! status: ${response.status}`);

                }



                const data = await response.json();



                if (data.error) {

                    throw new Error(data.error);

                }



                currentChatId = data.chatId;

                chatContainer.innerHTML = '';

                logoContainer.style.display = 'flex';

                bentoGrid.style.display = 'flex';

                userInput.value = '';

                submitButton.classList.remove('visible');

                addRecentChat(data.summary, currentChatId);

                loadRecentChats();

            } catch (error) {

                console.error('Error creating new chat:', error);

            }

        }



        async function loadRecentChats() {

            try {

                const response = await fetch('VotalityChat.php', {

                    method: 'POST',

                    headers: {

                        'Content-Type': 'application/json',

                    },

                    body: JSON.stringify({

                        action: 'getRecentChats'

                    }),

                });



                if (!response.ok) {

                    throw new Error(`HTTP error! status: ${response.status}`);

                }



                const data = await response.json();



                if (data.error) {

                    throw new Error(data.error);

                }



                const recentChatsContainer = document.getElementById('recent-chats');

                recentChatsContainer.innerHTML = '';



                data.chats.forEach(chat => {

                    addRecentChat(chat.summary, chat.id);

                });

            } catch (error) {

                console.error('Error loading recent chats:', error);

            }

        }



        function addRecentChat(summary, chatId) {

            const recentChatsContainer = document.getElementById('recent-chats');

            let chatElement = document.querySelector(`.recent-chat[data-chat-id="${chatId}"]`);

            

            if (!chatElement) {

                chatElement = document.createElement('div');

                chatElement.classList.add('recent-chat');

                chatElement.dataset.chatId = chatId;

                

                const menuIcon = document.createElement('i');

                menuIcon.setAttribute('data-feather', 'more-horizontal');

                menuIcon.classList.add('menu-icon');

                

                chatElement.appendChild(menuIcon);

                chatElement.onclick = () => loadChat(chatId);

                

                // Insert the new chat at the beginning of the list

                if (recentChatsContainer.firstChild) {

                    recentChatsContainer.insertBefore(chatElement, recentChatsContainer.firstChild);

                } else {

                    recentChatsContainer.appendChild(chatElement);

                }

            }

            

            const span = chatElement.querySelector('span') || document.createElement('span');

            span.textContent = summary;

            if (!chatElement.contains(span)) {

                chatElement.insertBefore(span, chatElement.firstChild);

            }



            feather.replace();



            // Limit to 10 recent chats

            while (recentChatsContainer.children.length > 10) {

                recentChatsContainer.removeChild(recentChatsContainer.lastChild);

            }



            // Ensure the container scrolls to the top to show the newest chat

            recentChatsContainer.scrollTop = 0;

        }



        async function loadChat(chatId) {

            try {

                const response = await fetch('VotalityChat.php', {

                    method: 'POST',

                    headers: {

                        'Content-Type': 'application/json',

                    },

                    body: JSON.stringify({

                        action: 'loadChat',

                        chatId: chatId

                    }),

                });



                if (!response.ok) {

                    throw new Error(`HTTP error! status: ${response.status}`);

                }



                const data = await response.json();



                if (data.error) {

                    throw new Error(data.error);

                }



                chatContainer.innerHTML = '';

                data.messages.forEach(message => {

                    addMessage(message.content, message.sender);

                });



                logoContainer.style.display = 'none';

                bentoGrid.style.display = 'none';

                chatContainer.style.display = 'flex';

                currentChatId = chatId;

                closeNav();

            } catch (error) {

                console.error('Error loading chat:', error);

            }

        }



        function openHelp() {

            // Implement help & FAQ functionality

            console.log('Opening Help & FAQ');

        }



        function openSettings() {

            // Implement settings functionality

            console.log('Opening Settings');

        }



        function openLearnMore() {

            // Implement learn more functionality

            console.log('Opening Learn More');

        }



        function logout() {

            fetch('profile_handler.php', {

                method: 'POST',

                headers: {

                    'Content-Type': 'application/x-www-form-urlencoded',

                },

                body: 'action=logout'

            }).then(() => {

                window.location.href = 'LoginPageBimo.html';

            }).catch(error => console.error('Error:', error));

        }



        // Debug function to check if hover is working

        function debugHover() {

            const recentChats = document.querySelectorAll('.recent-chat');

            recentChats.forEach(chat => {

                chat.addEventListener('mouseenter', () => {

                    console.log('Hover started on:', chat.querySelector('span').textContent);

                    const menuIcon = chat.querySelector('.menu-icon');

                    console.log('Menu icon display:', getComputedStyle(menuIcon).display);

                });

                chat.addEventListener('mouseleave', () => {

                    console.log('Hover ended on:', chat.querySelector('span').textContent);

                });

            });

        }



        // Prevent menu icon click from triggering the chat

        document.addEventListener('click', function(e) {

            if (e.target.closest('.menu-icon')) {

                e.stopPropagation();

                console.log('Menu clicked for:', e.target.closest('.recent-chat').querySelector('span').textContent);

                // Add your menu functionality here

            }

        });



        // Initialize

        document.addEventListener('DOMContentLoaded', () => {

            feather.replace();

            debugHover();

            console.log('Debug hover function initialized');

            updateUserEmailDisplay();

            loadRecentChats();

        });



// Add these variables at the top of your script

const waveAnimation = document.getElementById('wave-animation');

const attachmentButton = document.getElementById('attachment-button');

let isRecording = false;

let mediaRecorder;

let audioChunks = [];



// Speech recognition setup

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

const recognition = new SpeechRecognition();

recognition.continuous = true;

recognition.interimResults = true;



// Add these event listeners

waveAnimation.addEventListener('click', toggleRecording);

userInput.addEventListener('input', handleUserInput);



function handleUserInput() {

    const hasText = userInput.value.trim() !== '';

    waveAnimation.style.display = hasText ? 'none' : 'flex';

    submitButton.style.display = hasText ? 'block' : 'none';

}



function toggleRecording() {

    if (!isRecording) {

        startRecording();

    } else {

        stopRecording();

    }

}



function startRecording() {

    try {

        recognition.start();

        isRecording = true;

        waveAnimation.classList.add('recording');

        attachmentButton.innerHTML = `

            <div class="custom-rounded bg-transparent p-2 transition-colors duration-200">

                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-5 w-5 text-gray-600">

                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />

                </svg>

            </div>

        `;

        attachmentButton.removeEventListener('click', handleAttachment);

        attachmentButton.addEventListener('click', cancelRecording);

    } catch (err) {

        console.error('Error starting speech recognition:', err);

    }

}



function stopRecording() {

    if (isRecording) {

        recognition.stop();

        isRecording = false;

        waveAnimation.classList.remove('recording');

        submitButton.style.display = 'block';

        resetAttachmentButton();

    }

}



function cancelRecording() {

    if (isRecording) {

        recognition.stop();

        isRecording = false;

        waveAnimation.classList.remove('recording');

        userInput.value = '';

        resetAttachmentButton();

    }

}



function resetAttachmentButton() {

    attachmentButton.innerHTML = `

        <div class="custom-rounded bg-transparent p-2 transition-colors duration-200">

            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-5 w-5 text-gray-600">

                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />

            </svg>

        </div>

    `;

    attachmentButton.removeEventListener('click', cancelRecording);

    attachmentButton.addEventListener('click', handleAttachment);

    waveAnimation.style.display = 'flex';

}



recognition.onresult = (event) => {

    const resultIndex = event.resultIndex;

    const transcript = event.results[resultIndex][0].transcript;

    userInput.value = transcript;

    handleUserInput();

};



// Update the chat form submit event

document.getElementById('chat-form').addEventListener('submit', function(e) {

    e.preventDefault();

    const message = userInput.value.trim();

    if (message || audioChunks.length > 0) {

        if (audioChunks.length > 0) {

            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });

            sendMessage(message, audioBlob);

            audioChunks = [];

        } else {

            sendMessage(message);

        }

        userInput.value = '';

        submitButton.style.display = 'none';

        waveAnimation.style.display = 'flex';

        isRecording = false; // Reset recording state

    }

});

    </script>

</body>

</html>